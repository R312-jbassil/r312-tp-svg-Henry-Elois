---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <div class="flex items-center justify-center min-h-screen bg-base-200">
    <div class="card bg-white shadow-xl p-8 w-full max-w-md">
      <h1 class="text-2xl font-bold mb-4 text-center text-indigo-600">
        Créer un compte
      </h1>

      <form id="signup-form" class="space-y-4">
        <input
          type="email"
          id="email"
          name="email"
          class="input input-bordered w-full"
          placeholder="Adresse e-mail"
          required
        />

        <input
          type="password"
          id="password"
          name="password"
          class="input input-bordered w-full"
          placeholder="Mot de passe"
          required
        />

        <input
          type="password"
          id="passwordConfirm"
          name="passwordConfirm"
          class="input input-bordered w-full"
          placeholder="Confirmez le mot de passe"
          required
        />

        <button type="submit" class="btn btn-primary w-full">
          S'inscrire
        </button>

        <p class="text-sm text-center mt-2">
          Déjà un compte ?
          <a href="/login" class="link link-primary">Se connecter</a>
        </p>
      </form>
    </div>
  </div>

  <script>
    //@ts-nocheck
    document
      .getElementById("signup-form")
      ?.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value.trim();
        const passwordConfirm = document
          .getElementById("passwordConfirm")
          .value.trim();

        if (password !== passwordConfirm) {
          alert("❌ Les mots de passe ne correspondent pas !");
          return;
        }

        try {
          const res = await fetch("/api/signup", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password, passwordConfirm }),
          });

          const data = await res.json();

          if (res.ok) {
            alert("✅ Compte créé avec succès !");
            window.location.href = "/login";
          } else {
            alert(
              "❌ Erreur : " + (data.error || "Impossible de créer le compte")
            );
          }
        } catch (err) {
          console.error("Erreur signup:", err);
          alert("⚠️ Erreur réseau lors de l'inscription.");
        }
      });
  </script>
</Layout>
